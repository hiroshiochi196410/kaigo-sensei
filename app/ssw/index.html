<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>ä»‹è­·ãƒ­ãƒ¼ãƒ«ãƒ—ãƒ¬ã‚¤AI</title>

<style>
body { font-family: system-ui, -apple-system, "Segoe UI", Roboto, sans-serif; margin: 18px; }
.row { display: flex; gap: 8px; flex-wrap: wrap; align-items: center; }
textarea { width: 100%; min-height: 100px; padding: 8px; }
button { padding: 6px 12px; border-radius: 8px; cursor: pointer; }
.card { border: 1px solid #ddd; border-radius: 10px; padding: 10px; margin-top: 10px; }
</style>
</head>

<body>

<h2>ä»‹è­·ãƒ­ãƒ¼ãƒ«ãƒ—ãƒ¬ã‚¤AI</h2>

<div class="row">
  <button id="fillExample">ä¾‹æ–‡ã‚’å…¥ã‚Œã‚‹</button>
  <button id="btnSpeakExampleJa">ğŸ”Šä¾‹æ–‡(JA)</button>
  <button id="btnSpeakExampleId">ğŸ”Šä¾‹æ–‡(ID)</button>
  <button id="btnSpeakTest">ğŸ”Šãƒ†ã‚¹ãƒˆ</button>
</div>

<h3>ä»‹è­·å£«ï¼ˆã‚ãªãŸï¼‰ã®ç™ºè©±ï¼ˆæ—¥æœ¬èªï¼‰</h3>
<textarea id="prompt"></textarea>

<div class="row">
  <button id="sendBtn">é€ä¿¡</button>
</div>

<div class="card">
  <h3>Stage2ï¼ˆæ¨å¥¨è¿”ç­”ï¼‰</h3>

  <b>ãƒ­ãƒ¼ãƒå­—ï¼ˆæ¨å¥¨è¿”ç­”ï¼‰</b>
  <button id="btnSpeakStage2Romaji">ğŸ”Š</button>
  <div id="romaji"></div>

  <br><br>

  <b>ã‚¤ãƒ³ãƒ‰ãƒã‚·ã‚¢èªï¼ˆæ¨å¥¨è¿”ç­”ï¼‰</b>
  <button id="btnSpeakStage2Id">ğŸ”Š</button>
  <div id="indonesian"></div>
</div>

<script>
/* ========= TTS åŸºæœ¬ ========= */
function ttsOK(){
  return "speechSynthesis" in window;
}

function romajiToNaturalJa(text){
  if(!text) return "";
  let t = " " + text + " ";
  t = t.replace(/\bwa\b/g, "ã¯");
  t = t.replace(/\bga\b/g, "ãŒ");
  t = t.replace(/\bwo\b/g, "ã‚’");
  t = t.replace(/\bno\b/g, "ã®");
  t = t.replace(/\bni\b/g, "ã«");
  t = t.replace(/\bde\b/g, "ã§");
  t = t.replace(/\bto\b/g, "ã¨");
  t = t.replace(/\bkara\b/g, "ã‹ã‚‰");
  t = t.replace(/\bmade\b/g, "ã¾ã§");
  return t.trim();
}

function speak(text, lang){
  if(!ttsOK()){
    alert("ã“ã®ãƒ–ãƒ©ã‚¦ã‚¶ã¯éŸ³å£°èª­ã¿ä¸Šã’ã«å¯¾å¿œã—ã¦ã„ã¾ã›ã‚“");
    return;
  }
  if(!text || !text.trim()){
    alert("èª­ã¿ä¸Šã’ã‚‹æ–‡ç« ãŒã‚ã‚Šã¾ã›ã‚“");
    return;
  }
  speechSynthesis.cancel();
  const u = new SpeechSynthesisUtterance(text);
  u.lang = lang === "id" ? "id-ID" : "ja-JP";
  u.rate = lang === "id" ? 0.9 : 1.0;
  speechSynthesis.speak(u);
}

/* ========= ãƒœã‚¿ãƒ³ ========= */
document.addEventListener("click", e => {
  const btn = e.target.closest("button");
  if(!btn) return;

  if(btn.id === "btnSpeakTest"){
    speak("ãƒ†ã‚¹ãƒˆã§ã™ã€‚éŸ³ãŒèã“ãˆã¾ã™ã‹ã€‚", "ja");
  }

  if(btn.id === "btnSpeakExampleJa"){
    speak(document.getElementById("prompt").value, "ja");
  }

  if(btn.id === "btnSpeakExampleId"){
    speak(document.getElementById("prompt").value, "id");
  }

  if(btn.id === "btnSpeakStage2Romaji"){
    const raw = document.getElementById("romaji").textContent;
    const fixed = romajiToNaturalJa(raw);
    speak(fixed, "ja");
  }

  if(btn.id === "btnSpeakStage2Id"){
    speak(document.getElementById("indonesian").textContent, "id");
  }
});

/* ========= ãƒ€ãƒŸãƒ¼é€ä¿¡ï¼ˆç¢ºèªç”¨ï¼‰ ========= */
document.getElementById("sendBtn").addEventListener("click", () => {
  document.getElementById("romaji").textContent =
    "Yakan no akari dake de wa fuan desu. Motto gutai-teki na taisaku o oshiete kudasai.";
  document.getElementById("indonesian").textContent =
    "Cahaya teko saja membuat saya cemas. Tolong beri tahu langkah yang lebih konkret.";
});
</script>

</body>
</html>
