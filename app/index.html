<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Kaigo Sensei</title>
<style>
body{font-family:sans-serif;background:#f6f7fb;margin:0}
header{background:#4f46e5;color:#fff;padding:40px}
main{max-width:900px;margin:40px auto;padding:20px}
button{padding:14px 22px;border:none;border-radius:8px;background:#4f46e5;color:#fff;font-size:16px}
.hidden{display:none}
.box{background:#fff;border-radius:12px;padding:20px;margin-top:20px}
</style>
</head>
<body>
<header>
<h1>Kaigo Sensei</h1>
<p>外国人介護職向け 会話練習AI</p>
</header>

<main>
<div id="trial">無料体験 残り <span id="left">3</span> 回</div>

<div class="box">
<h2>あなた：介護職</h2>
<textarea id="input" style="width:100%;height:120px"></textarea><br><br>
<button onclick="send()">送信</button>
</div>

<div class="box hidden" id="pay">
<h3>無料体験は終了しました</h3>
<button onclick="location.href='https://buy.stripe.com/xxxx'">本稼働へ</button>
</div>

<div class="box" id="out"></div>
</main>

<script>
let limit=3;
let used=Number(localStorage.getItem("used")||0);
function update(){
 document.getElementById("left").textContent=Math.max(0,limit-used);
 if(used>=limit){document.getElementById("pay").classList.remove("hidden")}
}
update();

async function send(){
 if(used>=limit) return;
 const text=document.getElementById("input").value;
 const res=await fetch("/api/chat",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({prompt:text})});
 const data=await res.json();
 document.getElementById("out").innerText=data.text||"error";
 used++;localStorage.setItem("used",used);update();
}
</script>
</body>
</html>
